## TCP

### 三次握手
![三次握手](../../img/e92d0ebc7d46413b.png)

假设 A 为客户端，B 为服务器端。

* 首先 B 处于 LISTEN（监听）状态，等待客户的连接请求。

* A 向 B 发送连接请求报文，SYN=1，ACK=0，选择一个初始的序号 x。

* B 收到连接请求报文，如果同意建立连接，则向 A 发送连接确认报文，SYN=1，ACK=1，确认号为 x+1，同时也选择一个初始的序号 y。

* A 收到 B 的连接确认报文后，还要向 B 发出确认，确认号为 y+1，序号为 x+1。

* B 收到 A 的确认后，连接建立。

### TCP 的四次挥手
![四次挥手](../../img/f87afe72c2df4c12ac.png)

以下描述不讨论序号和确认号，因为序号和确认号的规则比较简单。并且不讨论 ACK，因为 ACK 在连接建立之后都为 1。

* A 发送连接释放报文，FIN=1。

* B 收到之后发出确认，此时 TCP 属于半关闭状态，B 能向 A 发送数据但是 A 不能向 B 发送数据。

* 当 B 不再需要连接时，发送连接释放报文，FIN=1。

* A 收到后发出确认，进入 TIME-WAIT 状态，等待 2 MSL（最大报文存活时间）后释放连接。

* B 收到 A 的确认后释放连接。
